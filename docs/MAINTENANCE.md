# دليل الصيانة

هذا الدليل يوضح كيفية صيانة وإدارة تطبيق Doctor Syria في بيئة الإنتاج.

## المراقبة

### نظام المراقبة

يستخدم التطبيق Prometheus و Grafana للمراقبة. يمكنك الوصول إلى لوحات التحكم على:

- Grafana: https://monitor.doctor-syria.com
- Prometheus: https://metrics.doctor-syria.com

### التنبيهات

تم إعداد التنبيهات للحالات التالية:
- استخدام CPU > 80%
- استخدام الذاكرة > 85%
- مساحة القرص < 15%
- معدل الخطأ > 5%
- وقت الاستجابة > 1 ثانية
- مشاكل اتصال قاعدة البيانات
- مشاكل اتصال Redis
- توقف Celery

## النسخ الاحتياطي والاستعادة

### النسخ الاحتياطي التلقائي

يتم إجراء نسخ احتياطي يومياً في الساعة 3 صباحاً. للتحقق من حالة النسخ الاحتياطي:

```bash
./scripts/backup.sh
```

### استعادة النسخ الاحتياطي

لاستعادة نسخة احتياطية محددة:

```bash
./scripts/restore.sh YYYYMMDD_HHMMSS
```

## التحديثات

### تحديث التطبيق

لتحديث التطبيق إلى أحدث إصدار:

```bash
./scripts/update.sh
```

### خطوات التحديث اليدوي

1. إجراء نسخ احتياطي
2. سحب التغييرات من Git
3. إعادة بناء الصور
4. تحديث قاعدة البيانات
5. جمع الملفات الثابتة
6. إعادة تشغيل الخدمات
7. التحقق من الصحة

## استكشاف الأخطاء وإصلاحها

### فحص الصحة

لفحص صحة جميع مكونات النظام:

```bash
./scripts/healthcheck.sh
```

### السجلات

- سجلات التطبيق: `docker-compose logs web`
- سجلات Nginx: `/var/log/nginx/doctor_syria.*.log`
- سجلات قاعدة البيانات: `docker-compose logs db`
- سجلات Redis: `docker-compose logs redis`
- سجلات Celery: `docker-compose logs celery`

### المشاكل الشائعة

1. **بطء الأداء**
   - تحقق من استخدام الموارد
   - راجع سجلات قاعدة البيانات
   - تحقق من ذاكرة التخزين المؤقت Redis

2. **أخطاء 500**
   - راجع سجلات التطبيق
   - تحقق من اتصال قاعدة البيانات
   - تحقق من الذاكرة المتاحة

3. **مشاكل Celery**
   - تحقق من اتصال Redis
   - راجع سجلات Celery
   - تحقق من حالة العمال

## الأمان

### تحديثات الأمان

- تحقق من تحديثات نظام التشغيل أسبوعياً
- تحقق من تحديثات Docker أسبوعياً
- تحقق من تحديثات Python وNPM شهرياً

### شهادات SSL

- تجديد تلقائي مع Let's Encrypt
- التحقق من تاريخ انتهاء الصلاحية شهرياً

### النسخ الاحتياطي

- التحقق من صحة النسخ الاحتياطي أسبوعياً
- اختبار عملية الاستعادة شهرياً

## جهات الاتصال

- مسؤول النظام: admin@doctor-syria.com
- فريق التطوير: dev@doctor-syria.com
- الدعم الفني: support@doctor-syria.com
